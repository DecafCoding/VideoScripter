@page "/projects/{ProjectId:guid}/videos"
@using VideoScripter.Features.Projects.Models
@using VideoScripter.Features.Videos.Models
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Authorization

@attribute [Authorize]

<PageTitle>Manage Videos - VideoScripter</PageTitle>

<div class="container-fluid">
    @if (isLoading)
    {
        <div class="d-flex justify-content-center p-4">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    }
    else if (project == null)
    {
        <div class="text-center p-5">
            <i class="bi bi-exclamation-triangle display-1 text-warning"></i>
            <h3>Project Not Found</h3>
            <p class="text-muted">The project you're looking for doesn't exist or you don't have access to it.</p>
            <a href="/projects" class="btn btn-primary">Back to Projects</a>
        </div>
    }
    else
    {
        <div class="row mb-4">
            <div class="col">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/projects">Projects</a></li>
                        <li class="breadcrumb-item"><a href="@($"/projects/{ProjectId}")">@project.Name</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Videos</li>
                    </ol>
                </nav>
            </div>
        </div>

        <StatusMessage Message="@statusMessage" />

        <div class="row mb-4">
            <div class="col-md-8">
                <h1>Manage Videos</h1>
                <p class="text-muted">Find and add videos to your project. Select 2-5 videos on a similar topic.</p>
            </div>
            <div class="col-md-4 text-md-end">
                <a href="@($"/projects/{ProjectId}")" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Back to Project
                </a>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-7">
                <!-- YouTube Video Search Component -->
                <VideoSearch ProjectId="@ProjectId" 
                             OnVideoAdded="HandleVideoAdded" 
                             ExistingVideoIds="@projectVideoIds" />
            </div>
            <div class="col-lg-5">
                <!-- Project Videos Component -->
                <ProjectVideos ProjectId="@ProjectId" 
                               Videos="@projectVideos"
                               OnVideoRemoved="HandleVideoRemoved" />
            </div>
        </div>

        @if (projectVideos.Any())
        {
            <div class="row mt-4">
                <div class="col-12 text-center">
                    <a href="@($"/projects/{ProjectId}/transcripts")" class="btn btn-primary btn-lg">
                        <i class="bi bi-file-text"></i> View & Analyze Transcripts
                    </a>
                </div>
            </div>
        }
    }
</div>